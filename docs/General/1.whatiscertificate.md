---
layout: default
title: 证书概论
nav_order: 4
parent: 通用知识
permalink: /docs/general/
---


# 这是一个关于信任的故事

很久以来一直搞不清楚为什么要做证书，在做 VPN 的时候需要 VPN，做 Horizon view 的时候需要，做 vSphere 的时候也需要。之前请教过总监这个问题，他的解答如下：
证书是用来证明你的身份的，证书不可以被伪造所以很安全。证书有客户端证书和服务器证书，服务器证书用于用户来确认服务器的真实性，客户端证书用于服务器确定终端的真实性。

记住以上内容，就明确了证书的用途，但是还差底层原理的解析，本文将整理汇总几个经典的关于证书的文章，全面介绍证书。



# 起源

每个人的过去总会有很多隐秘的事，学时的恋爱，内心的小想法，而任何时候，这些秘密都应该藏在心底，藏在两个人之间。为了保守秘密，我们可能会给自己的日记加上密码锁；为了私密地和另一个人交谈，我们甚至会用一种只有我们懂的“语言“来交流。



这便是我们每个人能碰到的最早的与**保密**相关的故事。保密的目的在于保守秘密，不让别人知道属于我们隐秘的故事。



保密的方式可以是将内容整个加锁（密码锁），也可以是将文字本身加密（另一种语言）。对应到应用中，前者可能是文件加锁；后者则是通过特定算法来加密。



然而事实是，以上保密手段并不是绝对可靠，还记得初中最经常做的事便是帮别人开密码锁，迷你机械密码锁一般都比较简单，通过触觉、听觉不断转动转盘便可发现规律，最终打开密码锁。



语言的加密也很简单，无非是用特殊字符替换掉 A、B、C、D等，或者将字母进行顺序变换，使得写出来的东西别人一眼看不懂。如果能掌握规律，很容易破解出来。



如果要使得密码锁变得难以破解，有以下方法：机械密码锁使用更加复杂的内部构造，使得通过触觉，听觉不能获取锁的原理；除此之外，可以让密码锁有更多的转盘，让密码暴力猜解变得更难；另外，还应当有防暴力的手段，就像电影中保险箱中都会有块防钻孔玻璃一样，一旦检测到暴力破解，则锁死系统。对应到应用中，前者便是对加密程序的加固，使得加密程序不能被反编译，进而让别人无法猜到加密的原理；中间则是增加密码长度，避免密码猜解；最后就是密码尝试的次数限制。



如果要使得文本加密变得难以破解，可以在加密算法中加入扰乱的因素，例如本来只有26个字母，我们可以新增两个字母，让字母表有28个字母，然后随机假定两个字母是扰乱因子，随机写在我们的密文中。或者我们可以写5个不等的数字，然后将写好的信的每5个字母为一组，每组的每个字母按照数字循环累加，例如：5个数字分别为 1，3，4，7，9，信的内容为 i love you，则最终加密后会变为 j oscn zrr，这样的加密方式不再有恒定的规律，随着 5 个数字的不同，加密结果也不同，除非知道这组数字是什么，否则很难解密。



为了好玩，用 python 写了这样的一个加密/解密器，程序如下：



这样的加密足够安全，但唯一的问题是密钥可能被泄露。随着应用的广泛，密钥管理变成一件难事。



# 安全地分发密钥

如果是两个人之间沟通还好，放在现在的世界里，每天我们可能要去访问大量的网站，比如微博，微信，手机银行。在这种场景下，我们很难像两个人之间沟通一样，悄悄线下约定好密码，然后再加密传输。我们需要一种简单，安全的办法让服务器和我们之间自动协商出密码，同时保证密码不泄露。



目前最常用的方式是通过非对称加密算法进行协商过程的加密，再去协商出来的密钥进行数据的加密。



非对称加密的美在于加密和解密用的密钥不一样，这种加密有以下优点：

1. 公钥和私钥是一一对应的关系，有一把公钥就必然有一把与之对应的、独一无二的私钥，反之亦成立。
2. 所有的（公钥, 私钥）对都是不同的。
3. 用公钥可以解开私钥加密的信息，反之亦成立。
4. 同时生成公钥和私钥应该相对比较容易，但是从公钥推算出私钥，应该是很困难或者是不可能的。



有了非对称加密，服务器则可以大胆的将其公钥发给所有终端，然后终端通过公钥加密再去协商密钥，看似简单，但在互联网中，任何人都可以自己做一个网站出来，曾经就出现过假淘宝之类的网站，这时候又需要一种手段来确保我们访问的网站是正确的网站，而不是别人伪造的。s





















